{"version":3,"sources":["element-selectors.js"],"names":[],"mappings":"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","file":"element-selectors.js","sourceRoot":"/source/","sourcesContent":["import {Container,ViewSlot,transient} from 'aurelia-framework';\r\nimport {Compiler} from 'gooy/aurelia-compiler';\r\n\r\n/**\r\n * Element Selectors allows a similar functionality like content selectors\r\n * expect there are no `content` tags used.\r\n * instead the `select` attribute can be used on any tag and it will be filled with the\r\n * contents and attributes of the element found in the orginal content.\r\n */\r\n@transient()\r\nexport class ElementSelectors{\r\n\r\n  /**\r\n   * Used to associate this instance with a certain element\r\n   * @param container\r\n   */\r\n  init(container) {\r\n    this.container = container;\r\n    this.element = container.get(Element);\r\n    this.compiler = container.get(Compiler);\r\n  }\r\n\r\n  /**\r\n   * Apply element selectors\r\n   * this requires the behavior to have an originalFragment property from which the source elements will be extracted\r\n   */\r\n  applySelectors(){\r\n    let i,l, promise;\r\n\r\n    var behavior = this.element.primaryBehavior;\r\n    var fragment = behavior.originalFragment;\r\n\r\n    if(!fragment) throw new Error(\"no originalFragment found for\",this.element);\r\n\r\n    var targets = this.element.querySelectorAll(`[select]`);\r\n    this.unknownTargets = [].slice.call(targets);\r\n\r\n    for(i = 0, l = targets.length; i < l; i++){\r\n      var target = targets[i];\r\n      var selector = target.getAttribute(\"select\");\r\n\r\n      //get the first matching element\r\n      var source = fragment.querySelector(selector);\r\n\r\n      if(!source) continue;\r\n\r\n      //apply to target\r\n      this.copyContentAndAttributes(source, target);\r\n\r\n      //remove from unknown targets\r\n      this.unknownTargets = this.unknownTargets.filter(el=>el!==target);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a compose for elements that have a `view` or `view-model` property\r\n   */\r\n  createCompositions(){\r\n    var elements = this.element.querySelectorAll(\"[select]\");\r\n    //create compose elements if view-model or view is defined in one of the content elements\r\n    for(var i = 0, l = elements.length; i < l; i++){\r\n      var el = elements[i];\r\n\r\n      let vm = el.getAttribute(\"view-model\");\r\n      let view = el.getAttribute(\"view\");\r\n\r\n      if(vm || view){\r\n        var compose = document.createElement(\"compose\");\r\n        if(vm) compose.setAttribute(\"view-model\",vm);\r\n        if(view) compose.setAttribute(\"view\",view);\r\n        el.appendChild(compose);\r\n\r\n        //this.compiler.compile(compose);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all compose elements\r\n   *\r\n   * @param remove    if true the compose tag itself will be removed otherwise it will just be emptied\r\n   */\r\n  destroyCompositions(remove=true){\r\n    var compositions = this.element.querySelectorAll(\"compose\");\r\n    for(var i = 0, l = compositions.length; i < l; i++){\r\n      var compose = compositions[i];\r\n      compose.innerHTML = \"\";\r\n      if(remove) compose.parentNode.removeChild(compose);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Copies the contents and all attributes from one node to another\r\n   *\r\n   * @param source      source node\r\n   * @param target    target node\r\n   */\r\n  copyContentAndAttributes(source,target){\r\n    for(var i = 0, l = source.attributes.length; i < l; i++){\r\n      var attr = source.attributes[i];\r\n      if(attr===\"select\") continue;\r\n      target.setAttribute(attr.nodeName,attr.nodeValue);\r\n    }\r\n    target.textContent = source.textContent;\r\n    target.innerHTML = source.innerHTML;\r\n  }\r\n}\r\n"]}