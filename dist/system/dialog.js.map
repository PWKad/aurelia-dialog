{"version":3,"sources":["dialog.js"],"names":[],"mappings":"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","file":"dialog.js","sourceRoot":"/source/","sourcesContent":["import {skipContentProcessing,customElement,noView, bindable} from 'aurelia-framework';\nimport {Container,ViewSlot} from 'aurelia-framework';\nimport {Compiler} from 'gooy/aurelia-compiler';\nimport {VelocityAnimator} from \"gooy/aurelia-animator-velocity\";\nimport {ElementSelectors} from \"./element-selectors\";\n\n@customElement('dialog')\n@noView\n@skipContentProcessing\nexport class Dialog {\n\n  /**\n   * Allow view to be set dynamically\n   */\n  @bindable view;\n\n  isAnimating = false;\n  hasTitle = true;\n\n  createBackdrop = true;\n  elementSelectors = null;\n\n  closeOnContainerClick = true;\n\n  transition = null;\n\n  contentElementData;\n\n  static defaultConfig = {\n    view: \"gooy/aurelia-dialog/modal-bootstrap.html\",\n    animations: \"zoom-in leave-zoom-in\"\n  };\n\n  static inject = [Element,Compiler, Container, VelocityAnimator, ElementSelectors];\n\n  constructor(element, compiler, container, animator, elementSelectors) {\n    this.element = element;\n    //this.config = config;\n    this.compiler = compiler;\n    this.container = container;\n    this.animator = animator;\n    this.elementSelectors = elementSelectors;\n    this.elementSelectors.init(this.container);\n\n    this.config = Object.assign({},Dialog.defaultConfig);\n  }\n\n  bind(executionContext) {\n    this.executionContext = executionContext;\n\n    this.view = this.view||this.config.view;\n    if(!this.view) throw new Error(\"no view has been speified for the dialog\");\n  }\n\n  containerClick(e) {\n    if(this.closeOnContainerClick) this.close();\n  }\n\n  setTransitionClasses() {\n    if(!this.transition) return;\n    var i, l, _class, classes;\n\n    if(this.currentTransition){\n      classes = this.currentTransition;\n      for(i = 0, l = classes.length; i < l; i++){\n        _class = classes[i];\n        this.dialog.classList.remove(_class);\n      }\n    }\n\n    classes = this.transition;\n    if(typeof this.transition === \"string\"){\n      classes = this.transition.split(\" \");\n    }\n    for(i = 0, l = classes.length; i < l; i++){\n      _class = classes[i];\n      this.dialog.classList.add(_class);\n    }\n    this.currentTransition = classes;\n  }\n\n  open() {\n    if(this.backdrop) return;\n    if(this.createBackdrop) this._createBackdrop();\n\n    if(this.dialog){\n      this._open();\n    }else{\n\n      //swap this. with view-model references\n      var transformer = function(element,data){\n        //replace `this.` with the reference for this viewmodel\n        var viewModelRef = element.getAttribute(\"ref.view-model\");\n        if(viewModelRef) data = data.replace(/self\\./gm, viewModelRef + \".\");\n        return data;\n      };\n\n\n      return this.compiler.swapView(this.container, this.view,transformer).then(behavior=> {\n        this.elementSelectors.applySelectors();\n\n        //remove unused element selector targets\n        for(var i = 0, l = this.elementSelectors.unknownTargets.length; i < l; i++){\n          var target = this.elementSelectors.unknownTargets[i];\n          var selector = target.getAttribute(\"select\");\n          if(selector === \"container\" || selector === \"controls\" || selector === \"dialog\") continue;\n          if(target){\n            if(selector === \"title\") this.hasTitle = false;\n            target.parentNode.removeChild(target);\n          }\n        }\n\n        this._open();\n      });\n    }\n  }\n\n  _open() {\n\n    this.elementSelectors.createCompositions();\n\n    //compile the current behavior with the new template\n    var behavior = this.compiler.processBehavior(this.container,this.executionContext);\n\n    this.dialogContainer = this.element.querySelector(\"[select=container]\");\n    this.dialog = this.element.querySelector(\"[select=dialog]\");\n\n\n    if(this.dialogContainer) this.dialogContainer.addEventListener(\"click\", this.containerClick.bind(this));\n    this.dialog.addEventListener(\"click\", e=> {e.stopPropagation()});\n    this.element.dispatchEvent(new Event(\"done\"));\n\n    //this.container.classList.add(\"in\");\n    this.dialog.scrollTop = 0;\n\n    this.dialogContainer.setAttribute('aria-hidden', false);\n    this.dialogContainer.classList.add(\"in\");\n\n    this.element.classList.add(\"open\");\n\n    /*if(){\n      this.dialog.classList.add('au-animate');\n      this.dialog.classList.add('au-left');\n    }*/\n\n    this.setTransitionClasses();\n\n    return this.enterAnimation().then(()=> {\n      this.dialog.focus();\n    });\n  }\n\n  close() {\n\n    if(this.createBackdrop) this._destroyBackdrop();\n\n    if(!this.dialogContainer) return;\n    this.dialogContainer.setAttribute('aria-hidden', true);\n    this.dialogContainer.classList.remove(\"in\");\n\n    return this.leaveAnimation().then(()=> {\n      this.element.dispatchEvent(new Event(\"close\"));\n      this.element.classList.remove(\"open\");\n\n      //unbind and detach the viewSlot for this VM\n      var viewSlot = this.container.get(ViewSlot);\n      viewSlot.unbind();\n      viewSlot.detached();\n\n      //destroy the composed elements\n      this.elementSelectors.destroyCompositions();\n\n    });\n  }\n\n  enterAnimation(force) {\n    if(this.isAnimating && !force) Promise.resolve();\n\n    this.isAnimating = true;\n    return this.animator.enter(this.dialog).then(success=> {\n      setTimeout(()=> {\n        this.isAnimating = false;\n      }, 100);\n    });\n  }\n\n  leaveAnimation(force) {\n    if(this.isAnimating && !force) Promise.resolve();\n\n    this.isAnimating = true;\n    return this.animator.leave(this.dialog).then(success=> {\n      setTimeout(()=> {\n        this.isAnimating = false;\n      }, 100);\n    });\n  }\n\n  _createBackdrop() {\n    if(this.backdrop) return;\n\n    this.backdrop = document.createElement(\"div\");\n    this.backdrop.className = \"modal-backdrop fade\";\n\n    document.body.appendChild(this.backdrop);\n\n    setTimeout(()=> {\n      this.backdrop.classList.add(\"in\");\n    });\n  }\n\n  _destroyBackdrop() {\n    if(!this.backdrop) return;\n    this.backdrop.classList.remove(\"in\");\n\n    setTimeout(()=> {\n      if(this.backdrop) this.backdrop.parentNode.removeChild(this.backdrop);\n      this.backdrop = null;\n    }, 400);\n\n  }\n\n}\n\n"]}