{"version":3,"sources":["dialog.js"],"names":[],"mappings":"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","file":"dialog.js","sourceRoot":"/source/","sourcesContent":["import {skipContentProcessing,customElement,noView, bindable} from 'aurelia-framework';\r\nimport {Container,ViewSlot} from 'aurelia-framework';\r\nimport {Compiler} from 'gooy/aurelia-compiler';\r\nimport {VelocityAnimator} from \"gooy/aurelia-animator-velocity\";\r\nimport {ElementSelectors} from \"./element-selectors\";\r\n\r\n@customElement('dialog')\r\n@noView\r\n@skipContentProcessing\r\nexport class Dialog {\r\n\r\n  /**\r\n   * Allow view to be set dynamically\r\n   */\r\n  @bindable view;\r\n\r\n  isAnimating = false;\r\n  hasTitle = true;\r\n\r\n  createBackdrop = true;\r\n  elementSelectors = null;\r\n\r\n  closeOnContainerClick = true;\r\n\r\n  transition = null;\r\n\r\n  contentElementData;\r\n\r\n  static defaultConfig = {\r\n    view: \"gooy/aurelia-dialog/modal-bootstrap.html\",\r\n    animations: \"zoom-in leave-zoom-in\"\r\n  };\r\n\r\n  static inject = [Element,Compiler, Container, VelocityAnimator, ElementSelectors];\r\n\r\n  constructor(element, compiler, container, animator, elementSelectors) {\r\n    this.element = element;\r\n    //this.config = config;\r\n    this.compiler = compiler;\r\n    this.container = container;\r\n    this.animator = animator;\r\n    this.elementSelectors = elementSelectors;\r\n    this.elementSelectors.init(this.container);\r\n\r\n    this.config = Object.assign({},Dialog.defaultConfig);\r\n  }\r\n\r\n  bind(executionContext) {\r\n    this.executionContext = executionContext;\r\n\r\n    this.view = this.view||this.config.view;\r\n    if(!this.view) throw new Error(\"no view has been speified for the dialog\");\r\n  }\r\n\r\n  containerClick(e) {\r\n    if(this.closeOnContainerClick) this.close();\r\n  }\r\n\r\n  setTransitionClasses() {\r\n    if(!this.transition) return;\r\n    var i, l, _class, classes;\r\n\r\n    if(this.currentTransition){\r\n      classes = this.currentTransition;\r\n      for(i = 0, l = classes.length; i < l; i++){\r\n        _class = classes[i];\r\n        this.dialog.classList.remove(_class);\r\n      }\r\n    }\r\n\r\n    classes = this.transition;\r\n    if(typeof this.transition === \"string\"){\r\n      classes = this.transition.split(\" \");\r\n    }\r\n    for(i = 0, l = classes.length; i < l; i++){\r\n      _class = classes[i];\r\n      this.dialog.classList.add(_class);\r\n    }\r\n    this.currentTransition = classes;\r\n  }\r\n\r\n  open() {\r\n    if(this.backdrop) return;\r\n    if(this.createBackdrop) this._createBackdrop();\r\n\r\n    if(this.dialog){\r\n      this._open();\r\n    }else{\r\n\r\n      //swap this. with view-model references\r\n      var transformer = function(element,data){\r\n        //replace `this.` with the reference for this viewmodel\r\n        var viewModelRef = element.getAttribute(\"ref.view-model\");\r\n        if(viewModelRef) data = data.replace(/self\\./gm, viewModelRef + \".\");\r\n        return data;\r\n      };\r\n\r\n\r\n      return this.compiler.swapView(this.container, this.view,transformer).then(behavior=> {\r\n        this.elementSelectors.applySelectors();\r\n\r\n        //remove unused element selector targets\r\n        for(var i = 0, l = this.elementSelectors.unknownTargets.length; i < l; i++){\r\n          var target = this.elementSelectors.unknownTargets[i];\r\n          var selector = target.getAttribute(\"select\");\r\n          if(selector === \"container\" || selector === \"controls\" || selector === \"dialog\") continue;\r\n          if(target){\r\n            if(selector === \"title\") this.hasTitle = false;\r\n            target.parentNode.removeChild(target);\r\n          }\r\n        }\r\n\r\n        this._open();\r\n      });\r\n    }\r\n  }\r\n\r\n  _open() {\r\n\r\n    this.elementSelectors.createCompositions();\r\n\r\n    //compile the current behavior with the new template\r\n    var behavior = this.compiler.processBehavior(this.container,this.executionContext);\r\n\r\n    this.dialogContainer = this.element.querySelector(\"[select=container]\");\r\n    this.dialog = this.element.querySelector(\"[select=dialog]\");\r\n\r\n\r\n    if(this.dialogContainer) this.dialogContainer.addEventListener(\"click\", this.containerClick.bind(this));\r\n    this.dialog.addEventListener(\"click\", e=> {e.stopPropagation()});\r\n    this.element.dispatchEvent(new Event(\"done\"));\r\n\r\n    //this.container.classList.add(\"in\");\r\n    this.dialog.scrollTop = 0;\r\n\r\n    this.dialogContainer.setAttribute('aria-hidden', false);\r\n    this.dialogContainer.classList.add(\"in\");\r\n\r\n    this.element.classList.add(\"open\");\r\n\r\n    /*if(){\r\n      this.dialog.classList.add('au-animate');\r\n      this.dialog.classList.add('au-left');\r\n    }*/\r\n\r\n    this.setTransitionClasses();\r\n\r\n    return this.enterAnimation().then(()=> {\r\n      this.dialog.focus();\r\n    });\r\n  }\r\n\r\n  close() {\r\n\r\n    if(this.createBackdrop) this._destroyBackdrop();\r\n\r\n    if(!this.dialogContainer) return;\r\n    this.dialogContainer.setAttribute('aria-hidden', true);\r\n    this.dialogContainer.classList.remove(\"in\");\r\n\r\n    return this.leaveAnimation().then(()=> {\r\n      this.element.dispatchEvent(new Event(\"close\"));\r\n      this.element.classList.remove(\"open\");\r\n\r\n      //unbind and detach the viewSlot for this VM\r\n      var viewSlot = this.container.get(ViewSlot);\r\n      viewSlot.unbind();\r\n      viewSlot.detached();\r\n\r\n      //destroy the composed elements\r\n      this.elementSelectors.destroyCompositions();\r\n\r\n    });\r\n  }\r\n\r\n  enterAnimation(force) {\r\n    if(this.isAnimating && !force) Promise.resolve();\r\n\r\n    this.isAnimating = true;\r\n    return this.animator.enter(this.dialog).then(success=> {\r\n      setTimeout(()=> {\r\n        this.isAnimating = false;\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  leaveAnimation(force) {\r\n    if(this.isAnimating && !force) Promise.resolve();\r\n\r\n    this.isAnimating = true;\r\n    return this.animator.leave(this.dialog).then(success=> {\r\n      setTimeout(()=> {\r\n        this.isAnimating = false;\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  _createBackdrop() {\r\n    if(this.backdrop) return;\r\n\r\n    this.backdrop = document.createElement(\"div\");\r\n    this.backdrop.className = \"modal-backdrop fade\";\r\n\r\n    document.body.appendChild(this.backdrop);\r\n\r\n    setTimeout(()=> {\r\n      this.backdrop.classList.add(\"in\");\r\n    });\r\n  }\r\n\r\n  _destroyBackdrop() {\r\n    if(!this.backdrop) return;\r\n    this.backdrop.classList.remove(\"in\");\r\n\r\n    setTimeout(()=> {\r\n      if(this.backdrop) this.backdrop.parentNode.removeChild(this.backdrop);\r\n      this.backdrop = null;\r\n    }, 400);\r\n\r\n  }\r\n\r\n}\r\n\r\n"]}