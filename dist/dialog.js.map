{"version":3,"sources":["dialog.js"],"names":[],"mappings":"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","file":"dialog.js","sourceRoot":"/source/","sourcesContent":["import {skipContentProcessing,noView, bindable} from 'aurelia-framework';\nimport {Container,ViewSlot} from 'aurelia-framework';\nimport {Compiler} from 'gooy/aurelia-compiler';\nimport {CssAnimator} from \"aaike/animator-css\";\n\n@noView\n@skipContentProcessing\nexport class DialogCustomElement {\n\n  @bindable view;\n\n  contentElements = [];\n\n  isAnimating = false;\n  hasTitle = true;\n\n  createBackdrop = true;\n\n  closeOnContainerClick = true;\n\n  transition = null;\n\n  static inject = [Element,Compiler,Container,CssAnimator];\n  constructor(element,compiler,container,animator) {\n    this.element = element;\n    this.compiler = compiler;\n    this.container = container;\n    this.animator = animator;\n  }\n\n  bind(executionContext) {\n    this.executionContext = executionContext;\n  }\n\n  copyContentAndAttributes(node,target){\n    if(!node) return;\n    if(!target) return;\n\n    for(var i = 0, l = node.attributes.length; i < l; i++){\n      var attr = node.attributes[i];\n      target.setAttribute(attr.nodeName,attr.nodeValue);\n    }\n    target.textContent = node.textContent;\n    target.innerHTML = node.innerHTML;\n  }\n\n  cloneContentElements(el){\n    for(var i = 0, l = el.children.length; i < l; i++){\n      var child = el.children[i];\n      var clone = child.cloneNode(true);\n\n      if(clone) this.contentElements.push(clone);\n      //this.title = this.element.querySelector(\":scope > dialog-title\").cloneNode(true) ;\n    }\n  }\n\n  applyContentElements(){\n    let i,l, promise;\n\n    var refNodes = this.element.querySelectorAll(`[ref-id]`);\n    var refs = [];\n\n    for(i = 0, l = refNodes.length; i < l; i++){\n      refs.push(refNodes[i].getAttribute(\"ref-id\"));\n    }\n\n    var unusedRefs = [].concat(refs);\n    var usedRefs = [];\n\n    for(i = 0, l = this.contentElements.length; i < l; i++){\n      var el = this.contentElements[i];\n      let refName = camelize(el.nodeName.toLowerCase());\n      let refNode = this.element.querySelector(`[ref-id=${refName}]`);\n\n      usedRefs.push(refName);\n\n      let vm = el.getAttribute(\"view-model\");\n      let view = el.getAttribute(\"view\");\n\n      if(vm){\n        promise = this.compiler.loadVM(vm).then(viewModel=>{\n          console.log('viewModel',viewModel);\n\n          //return null;\n\n          //var container = new Container();\n          //var viewSlot = new ViewSlot(refNode,true);\n          this.behaviorInstance = viewModel.metadata.create(this.container,{},refNode);\n\n          console.log('refNode', refNode);\n          console.log('behaviorInstance', this.behaviorInstance);\n          return;\n\n          viewSlot.bind(this.behaviorInstance.executionContext);\n\n          setTimeout(()=>{\n            this.behaviorInstance.view.attached();\n            viewSlot.attached();\n            this.behaviorInstance.bind(this.behaviorInstance.executionContext);\n            this.behaviorInstance.attached();\n          });\n\n          console.log('behaviorInstance', this.behaviorInstance);\n\n          //this.behaviorInstance.view.attached();\n\n          /*var view = viewModel.metadata.viewFactory.create(,viewModel.value());\n\n          for(var i = 0, l = view.fragment.children.length; i < l; i++){\n            var child = view.fragment.children[i];\n\n            if(child && child instanceof Node) {\n              refNode.appendChild(child);\n              i--;\n            }\n          }*/\n        });\n      }else if(view){\n        promise = this.compiler.loadTemplate(view,refNode).then((result)=> {\n          let {template,refNode:data} = result;\n\n          refNode.innerHTML = \"\";\n          for(var i = 0, l = template.content.children.length; i < l; i++){\n            var child = template.content.children[i];\n\n            if(child && child instanceof Node) {\n              refNode.appendChild(child);\n              i--;\n            }\n          }\n          //var data = [0].outerHTML;\n          //refNode.innerHTML = data;\n        });\n\n      }else{\n        this.copyContentAndAttributes(el, refNode);\n\n      }\n    }\n\n    for(i = 0, l = usedRefs.length; i < l; i++){\n      var ref = usedRefs[i];\n      var p = unusedRefs.indexOf(ref);\n      unusedRefs.splice(p,1);\n    }\n\n    //remove unused dialog refs\n    for(i = 0, l = unusedRefs.length; i < l; i++){\n      var r = unusedRefs[i];\n      if(r===\"container\"||r===\"controls\"||r===\"dialog\") continue;\n      var refNode = this.element.querySelector(`[ref-id=${r}]`);\n      if(refNode) {\n        if(r===\"title\") this.hasTitle = false;\n        refNode.parentNode.removeChild(refNode);\n      }\n    }\n\n    return promise||Promise.resolve();\n\n  }\n\n  attached(){\n\n    this.cloneContentElements(this.element);\n\n    //this.oarticle = this.element.querySelector(\":scope > article\");\n    //this.ofooter = this.element.querySelector(\":scope > footer\");\n\n    //this.element.innerHTML = \"\";\n    //this.compiler.composeBehavior(this.container,{view:this.view},this.executionContext).then(this.viewAttached.bind(this));\n\n    //this.compiler.composeElement(this.element,this,{view:this.view}).then(this.viewAttached.bind(this));\n\n    this.compiler.loadTemplate(this.view).then(result=>{\n      let template = result.template;\n      //replace this with the reference for this viewmodel\n      var data = template.content.children[0].outerHTML;\n      /*\n      var re = /(.*)?(\\${)(.*)?(this\\.)?(.*)?(\\})(.*)?/gm;\n\n      var newData = \"\";\n\n      //var lines = data.split(\"\\n\");\n      //for(var i = 0, l = lines.length; i < l; i++){\n        //var line = lines[i];\n       // console.log('line', line);\n        var m;\n        while((m = re.exec(data)) !== null){\n          if(m.index === re.lastIndex){\n            re.lastIndex++;\n          }\n          for(var i2 = 0, l2 = m.length; i2 < l2; i2++){\n            var p = m[i2];\n            newData += p m[1] + m[2] + m[3] + viewModelRef + \".\" + m[5] + m[6] + m[7] + \"\\n\";\n          }\n\n        }\n      //}*/\n\n      var viewModelRef = this.element.getAttribute(\"ref.view-model\");\n\n      data = data.replace(/this\\./gm,viewModelRef+\".\");\n\n      //data.replace(re,);\n\n      //apply the template\n      this.element.innerHTML = data;\n\n      //apply the cloned content elements\n      this.applyContentElements().then(()=>{\n        console.log('contents applied');\n        //compile the current behavior with the new template\n        this.compiler.processBehavior(this.container);\n        this.viewAttached();\n      });\n\n    });\n\n    /*this.compiler.loadText(this.view).then(data=>{\n      var template = document.createElement(\"template\");\n\n      this.element.innerHTML = data;\n\n      var fragment = document.createDocumentFragment();\n      fragment.appendChild(data);\n\n      template.content.innerHTML = fragment.innerHTML;\n\n      console.log('template.content', template.content);\n      console.log('template.content.innerHTML', template.content.innerHTML);\n    });*/\n\n    /*this.compiler.loadViewFactory(this.view).then(viewFactory=>{\n      console.log('viewFactory', viewFactory);\n\n      for(var i = 0, l = viewFactory.instructions.length; i < l; i++){\n        var instruction = viewFactory.instructions[i];\n\n        if(instruction.contentExpression){\n\n          for(var i2 = 0, l2 = instruction.contentExpression.parts.length; i2 < l; i2++){\n            var part = instruction.contentExpression.parts[i2];\n            console.log('part', part);\n            if(part instanceof AccessScope){\n              console.log('partSDS', part);\n              if(part.name==\"title\") part.name == \"testtitle\";\n            }\n          }\n        }\n      }\n\n      this.element.innerHTML = \"\";\n      this.compiler.composeViewFactory(this.container,this.executionContext,viewFactory);\n      this.viewAttached();\n      //this.element.innerHTML = viewFactory.template.content.children[0].outerHTML;\n    });*/\n\n  }\n\n  viewAttached(){\n    this.container = this.element.querySelector(\"[ref-id=container]\");\n    this.dialog = this.element.querySelector(\"[ref-id=dialog]\");\n    this.dialog.classList.add('au-out');\n    this.dialog.classList.add('au-animate');\n    //if(this.transition) this.dialog.classList.add('anim-'+this.transition);\n\n    if(this.container) {\n      this.container.addEventListener(\"click\",this.containerClick.bind(this));\n    }\n\n\n    this.dialog.addEventListener(\"click\",e=>{e.stopPropagation()});\n\n    this.element.dispatchEvent(new Event(\"done\"));\n\n    /*var defaultBtnClose = this.element.querySelector(`[ref-id=dialogCloseButton]`);\n    if(defaultBtnClose){\n      console.log('close',defaultBtnClose);\n      defaultBtnClose.addEventListener(\"click\",()=>{\n        this.dialog = this.element.children[0];\n        this.close();\n      });\n    }*/\n  }\n\n  containerClick(e) {\n    if(this.closeOnContainerClick) this.close();\n  }\n\n  open(){\n    if(this.backdrop) return;\n    if(this.createBackdrop) this._createBackdrop();\n\n    if(this.currentTransition) this.dialog.classList.remove(this.currentTransition);\n    this.dialog.classList.add(this.transition);\n    this.currentTransition = this.transition;\n    this.container.setAttribute('aria-hidden', false);\n    this.container.style.display = \"block\";\n    //this.container.classList.add(\"in\");\n    this.dialog.scrollTop = 0;\n\n    return this.enterAnimation().then(()=>{\n      this.dialog.focus();\n    });\n  }\n\n  close(){\n\n    if(this.createBackdrop) this._destroyBackdrop();\n\n    if(!this.container) return;\n    this.container.setAttribute('aria-hidden', true);\n    this.container.classList.remove(\"in\");\n\n    return this.leaveAnimation().then(()=>{\n      this.element.dispatchEvent(new Event(\"close\"));\n      this.container.style.display = \"none\";\n    });\n  }\n\n  enterAnimation(force) {\n    if(this.isAnimating && !force) Promise.resolve();\n\n    this.isAnimating = true;\n    return this.animator.enter(this.dialog).then(success=>{\n      setTimeout(()=> {\n        this.isAnimating = false;\n      },100);\n    });\n  }\n\n  leaveAnimation(force) {\n    if(this.isAnimating && !force) Promise.resolve();\n\n    this.isAnimating = true;\n    return this.animator.leave(this.dialog).then(success=>{\n      setTimeout(()=> {\n        this.isAnimating = false;\n      },100);\n    });\n  }\n\n  _createBackdrop() {\n    if(this.backdrop) return;\n\n    this.backdrop = document.createElement(\"div\");\n    this.backdrop.className = \"modal-backdrop fade\";\n\n    document.body.appendChild(this.backdrop);\n\n    setTimeout(()=>{\n      this.backdrop.classList.add(\"in\");\n    });\n  }\n\n  _destroyBackdrop() {\n    if(!this.backdrop) return;\n    this.backdrop.classList.remove(\"in\");\n\n    setTimeout(()=>{\n      if(this.backdrop) this.backdrop.parentNode.removeChild(this.backdrop);\n      this.backdrop = null;\n    },400);\n\n  }\n\n}\n\nfunction camelize(str){\n  return str.trim().replace(/[-_\\s]+(.)?/g, (match, c)=>{\n    return c ? c.toUpperCase() : \"\";\n  });\n}\n"]}